<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’§ water</title>
    <style>
        /* --------------------------- */
        /* Body å’Œæ•´ä½“å¸ƒå±€ */
        /* --------------------------- */
        body {
            min-height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
            font-size: 80px;
            font-family: Arial, sans-serif;
            overflow: hidden;
            width: 100vw; 
            position: relative;
            cursor: pointer; 
        }

        /* --------------------------- */
        /* è¯­è¨€åˆ‡æ¢å™¨æ ·å¼ (ä¿æŒä¸å˜) */
        /* --------------------------- */
        #language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            padding: 10px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        #language-switcher label {
            font-size: 16px;
            margin-right: 10px;
            color: #333;
            font-weight: bold;
        }

        #langSelect {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 16px;
            cursor: pointer;
        }

        /* --------------------------- */
        /* è®¡åˆ†æ¿å’ŒçŠ¶æ€æ˜¾ç¤º (ä¿æŒä¸å˜) */
        /* --------------------------- */
        #game-info {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 50;
            display: flex;
            gap: 50px;
            font-size: 30px;
            font-weight: bold;
            color: #333;
            background: rgba(255, 255, 255, 0.7);
            padding: 10px 30px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transition: opacity 0.5s;
        }

        /* --------------------------- */
        /* å›¾ç‰‡æ ·å¼ (ä¿æŒä¸å˜) */
        /* --------------------------- */
        .side-image-container {
            position: absolute; 
            top: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 40vw; 
            box-sizing: border-box;
            z-index: 1; 
        }

        .side-image-container:first-of-type { left: 0; }
        .side-image-container:last-of-type { right: 0; }

        .side-image-container img {
            max-height: 85vh; 
            max-width: 85%; 
            width: auto;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* --------------------------- */
        /* æ‰‹éƒ¨å’Œæ°´æ»´æ ·å¼ */
        /* --------------------------- */
        .hand-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: absolute;
            /* æ‰‹éƒ¨ä½ç½®ï¼šå±å¹•é«˜åº¦çš„ 2/3 å¤„ */
            top: 67%; 
            left: 50%;
            transform: translate(-50%, -50%); 
            
            width: 250px; 
            height: 9em;
            z-index: 10; 
        }

        .hand-container > div {
            line-height: 1;
            transition: none; 
            position: absolute;
        }

        #hand-down { top: 1em; opacity: 1; }
        #hand-up { top: 0; opacity: 0; }

        /* åŸå§‹æ°´æ»´æ¨¡æ¿ï¼Œé»˜è®¤éšè— */
        #droplet-template {
            position: absolute;
            font-size: 0.8em;
            color: blue;
            top: 0;
            left: 50%;
            transform: translateX(-50%); 
            opacity: 0;
            transition: none; 
            display: none; /* éšè—æ¨¡æ¿ */
        }

        /* æ‰€æœ‰åŠ¨æ€å…‹éš†çš„æ°´æ»´å…ƒç´  */
        .dynamic-droplet {
            position: absolute;
            font-size: 0.8em;
            color: blue;
            top: 0;
            left: 50%;
            transform: translateX(-50%); 
            opacity: 1;
            transition: none; 
        }

        /* --------------------------- */
        /* æŠ›ç‰©çº¿åŠ¨ç”» (ä¿æŒä¸å˜) */
        /* --------------------------- */
        .falling {
            /* åŠ¨ç”»æ—¶é—´ä¿æŒ 1.5s */
            animation: parabola-throw 1.5s cubic-bezier(0.4, 0.0, 0.6, 1.0) forwards;
        }

        @keyframes parabola-throw {
            0% { 
                transform: translate(-50%, 0) scale(1); 
                opacity: 1; 
            }
            50% {
                transform: translate(30vw, -100vh) scale(1.1); 
                opacity: 1; 
            }
            100% { 
                transform: translate(45vw, 0) scale(1);
                opacity: 1; 
            }
        }
          
        /* å¯åŠ¨/ç»“æŸè¦†ç›–å±‚ (ä¿æŒä¸å˜) */
        #startButtonOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            cursor: pointer;
            z-index: 1000;
            transition: opacity 0.5s;
        }

        #startButton {
            padding: 20px 40px;
            background-color: #007bff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 30px;
            color: white;
            outline: none;
            margin-top: 20px;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    
    <div id="language-switcher">
        <label for="langSelect">Language:</label>
        <select id="langSelect">
            <option value="zh">ä¸­æ–‡ (Chinese)</option>
            <option value="ko">í•œêµ­ì–´ (Korean)</option>
        </select>
    </div>

    <div id="game-info">
        <span id="scoreDisplay"></span>
        <span id="timerDisplay"></span>
    </div>

    <div class="side-image-container">
        <img src="evan.png" alt="Evan">
    </div>

    <div id="startButtonOverlay">
        <h1 id="overlayMessage"></h1>
        <p id="overlayScore"></p>
        <button id="startButton"></button>
    </div>

    <div class="hand-container">
        <div id="hand-up">ğŸ«´</div>
        <div id="hand-down">ğŸ«³</div>
        <div id="droplet-template" class="dynamic-droplet">ğŸ’§</div>
    </div>

    <div class="side-image-container">
        <img src="alvin.png" alt="Alvin" id="alvinTarget">
    </div>

    <audio id="soundEffectTemplate" src="audio.mp3" preload="auto"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ---------------------------
            // è¯­è¨€æ•°æ®å¯¹è±¡
            // ---------------------------
            const texts = {
                zh: {
                    title: "æ°´æ»´æŠ•æ·æŒ‘æˆ˜ï¼",
                    start_button: "ç‚¹å‡»å¼€å§‹ (30ç§’)",
                    score_prefix: "åˆ†æ•°: ",
                    timer_prefix: "æ—¶é—´: ",
                    time_unit: "ç§’",
                    time_up: "æ—¶é—´åˆ°!",
                    final_score: (score) => `æ‚¨çš„æœ€ç»ˆå¾—åˆ†æ˜¯: ${score} åˆ†`,
                    play_again: "å†ç©ä¸€æ¬¡"
                },
                ko: {
                    title: "ë¬¼ë°©ìš¸ ë˜ì§€ê¸° ì±Œë¦°ì§€!",
                    start_button: "í´ë¦­í•˜ì—¬ ì‹œì‘ (30ì´ˆ)",
                    score_prefix: "ì ìˆ˜: ",
                    timer_prefix: "ì‹œê°„: ",
                    time_unit: "ì´ˆ",
                    time_up: "ì‹œê°„ ì¢…ë£Œ!",
                    final_score: (score) => `ìµœì¢… ì ìˆ˜ëŠ” ${score}ì  ì…ë‹ˆë‹¤`,
                    play_again: "ë‹¤ì‹œ í”Œë ˆì´"
                }
            };

            // ---------------------------
            // DOM å…ƒç´ å’ŒçŠ¶æ€
            // ---------------------------
            const langSelect = document.getElementById('langSelect');
            const handDown = document.getElementById('hand-down');
            const handUp = document.getElementById('hand-up');
            const dropletTemplate = document.getElementById('droplet-template');
            const handContainer = document.querySelector('.hand-container');
            const soundEffectTemplate = document.getElementById('soundEffectTemplate'); 
            
            const startButtonOverlay = document.getElementById('startButtonOverlay');
            const startButton = document.getElementById('startButton');
            const overlayMessage = document.getElementById('overlayMessage');
            const overlayScore = document.getElementById('overlayScore');
            const scoreDisplay = document.getElementById('scoreDisplay');
            const timerDisplay = document.getElementById('timerDisplay');
            const gameInfo = document.getElementById('game-info');
            const alvinTarget = document.getElementById('alvinTarget');
            const body = document.body;

            const GAME_DURATION = 30;
            const AUDIO_POOL_SIZE = 10; // éŸ³é¢‘æ± å¤§å°
            let score = 0;
            let totalHits = 0;
            let timeLeft = GAME_DURATION;
            let gameRunning = false;
            let currentLang = langSelect.value; 
            let timerInterval;
            
            // éŸ³é¢‘æ± çŠ¶æ€
            const audioPool = [];
            let currentAudioIndex = 0; 
            
            // ---------------------------
            // å…³é”®ä¿®å¤ï¼šé¢„å…ˆåˆ›å»ºéŸ³é¢‘æ± 
            // ---------------------------
            const setupAudioPool = () => {
                for (let i = 0; i < AUDIO_POOL_SIZE; i++) {
                    const audioClone = soundEffectTemplate.cloneNode(true);
                    audioPool.push(audioClone);
                }
                // ç§»é™¤éŸ³é¢‘æ¨¡æ¿ä»¥é˜²æ­¢è¯¯ç”¨
                soundEffectTemplate.remove(); 
            };

            // ---------------------------
            // è¯­è¨€åˆ‡æ¢å‡½æ•° (ä¿æŒä¸å˜)
            // ---------------------------
            const updateLanguage = (lang) => {
                const text = texts[lang];
                
                document.title = text.title;
                overlayMessage.textContent = gameRunning ? text.time_up : text.title;
                
                if (!gameRunning && startButtonOverlay.classList.contains('hidden') === false) {
                   overlayScore.textContent = text.final_score(score);
                   startButton.textContent = text.play_again;
                } else if (!gameRunning) {
                   startButton.textContent = text.start_button;
                }

                scoreDisplay.textContent = text.score_prefix + score;
                timerDisplay.textContent = text.timer_prefix + timeLeft + text.time_unit;
                
                currentLang = lang;
            };

            // ---------------------------
            // æ¸¸æˆæ ¸å¿ƒé€»è¾‘ï¼šç–¯ç‹‚æŠ•æ·
            // ---------------------------

            const throwDroplet = () => {
                if (!gameRunning) return;

                // 1. æ‰‹éƒ¨å¿«é€ŸåŠ¨ç”»
                handDown.style.opacity = '0';
                handUp.style.opacity = '1';
                setTimeout(() => {
                    handUp.style.opacity = '0';
                    handDown.style.opacity = '1';
                }, 80); 

                // 2. å…³é”®ï¼šä»éŸ³é¢‘æ± ä¸­è·å–å…ƒç´ å¹¶æ’­æ”¾
                const audioInstance = audioPool[currentAudioIndex];
                audioInstance.currentTime = 0; // ç¡®ä¿éŸ³é¢‘ä»å¤´å¼€å§‹
                audioInstance.play().catch(error => {
                    // å¿½ç•¥æ’­æ”¾å¤±è´¥ï¼Œæµè§ˆå™¨å¯èƒ½ä»åœ¨é™åˆ¶ä¸­
                });
                
                // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªéŸ³é¢‘ç´¢å¼• (å¾ªç¯ä½¿ç”¨)
                currentAudioIndex = (currentAudioIndex + 1) % AUDIO_POOL_SIZE; 

                // 3. å…‹éš†æ°´æ»´å¹¶å¯åŠ¨åŠ¨ç”»
                const newDroplet = dropletTemplate.cloneNode(true);
                newDroplet.id = '';
                newDroplet.style.display = 'block';
                
                handContainer.appendChild(newDroplet);
                newDroplet.offsetWidth; // å¼ºåˆ¶é‡ç»˜
                newDroplet.classList.add('falling'); 

                // 4. åŠ¨ç”»ç»“æŸåå¤„ç†
                newDroplet.addEventListener('animationend', () => {
                    checkHit(newDroplet);
                });
            };

            // æ£€æŸ¥å¾—åˆ†å¹¶æ¸…ç†æ°´æ»´
            const checkHit = (dropletElement) => {
                totalHits++;
                score = totalHits;
                scoreDisplay.textContent = texts[currentLang].score_prefix + score;

                // è§†è§‰åé¦ˆ (Alvin é—ªçƒ)
                alvinTarget.style.transition = '0.1s';
                alvinTarget.style.filter = 'brightness(1.5)';
                setTimeout(() => {
                    alvinTarget.style.filter = 'brightness(1)';
                }, 100);

                // æ¸…ç† DOMï¼šç§»é™¤åŠ¨ç”»å®Œæˆçš„æ°´æ»´
                dropletElement.remove();
            };
            
            // è®¡æ—¶å™¨å’Œæ¸¸æˆçŠ¶æ€é€»è¾‘ (ä¿æŒä¸å˜)
            const updateTimer = () => {
                timeLeft--;
                timerDisplay.textContent = texts[currentLang].timer_prefix + timeLeft + texts[currentLang].time_unit;

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            };

            const startGame = () => {
                score = 0;
                totalHits = 0;
                timeLeft = GAME_DURATION;
                gameRunning = true;
                
                // ç§»é™¤æ‰€æœ‰æ—§æ°´æ»´
                document.querySelectorAll('.hand-container .dynamic-droplet:not(#droplet-template)').forEach(d => d.remove());

                startButtonOverlay.style.opacity = '0';
                setTimeout(() => startButtonOverlay.classList.add('hidden'), 500);
                gameInfo.style.opacity = '1';

                scoreDisplay.textContent = texts[currentLang].score_prefix + '0';
                timerDisplay.textContent = texts[currentLang].timer_prefix + GAME_DURATION + texts[currentLang].time_unit;
                
                timerInterval = setInterval(updateTimer, 1000);
            };

            const endGame = () => {
                gameRunning = false;
                gameInfo.style.opacity = '0';
                
                // ç§»é™¤æ‰€æœ‰é£è¡Œä¸­çš„æ°´æ»´
                document.querySelectorAll('.hand-container .dynamic-droplet:not(#droplet-template)').forEach(d => d.remove());

                const text = texts[currentLang];
                overlayMessage.textContent = text.time_up;
                overlayScore.textContent = text.final_score(score);
                startButton.textContent = text.play_again;
                
                startButtonOverlay.classList.remove('hidden');
                startButtonOverlay.style.opacity = '1';
            };

            // ---------------------------
            // äº‹ä»¶ç›‘å¬å™¨å’Œåˆå§‹åŒ–
            // ---------------------------

            // 1. è¯­è¨€åˆ‡æ¢äº‹ä»¶
            langSelect.addEventListener('change', (e) => {
                updateLanguage(e.target.value);
            });

            // 2. ç›‘å¬å¯åŠ¨æŒ‰é’®å¼€å§‹æ¸¸æˆ
            startButton.addEventListener('click', () => {
                if (!gameRunning) {
                    // ç¡®ä¿åœ¨ç”¨æˆ·äº¤äº’åå¯åŠ¨éŸ³é¢‘æ± å’Œæ¸¸æˆ
                    setupAudioPool(); 
                    startGame();
                }
            });

            // 3. ç›‘å¬æ•´ä¸ª body ç‚¹å‡»è¿›è¡ŒæŠ•æ·
            body.addEventListener('click', (event) => {
                if (gameRunning && event.target !== startButton && event.target.closest('#language-switcher') === null) {
                    throwDroplet();
                }
            });

            // 4. åˆå§‹åŒ–
            // é¦–æ¬¡åŠ è½½æ—¶è°ƒç”¨ updateLanguage æ¥è®¾ç½®é»˜è®¤æ–‡æœ¬
            updateLanguage(currentLang); 
        });
    </script>
</body>
</html>
